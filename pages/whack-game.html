<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Whack Game ‚Äì Mini Gioco</title>

<style>
    body {
        margin: 0;
        background: #1b1b1b;
        font-family: Arial, sans-serif;
        user-select: none;
        touch-action: manipulation;
        color: white;
    }

    #game {
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        padding: 10px;
        box-sizing: border-box;
        gap: 12px;
    }

    .hole {
        width: 28vw;
        height: 28vw;
        max-width: 150px;
        max-height: 150px;
        background: #000;
        border-radius: 50%;
        position: relative;
        overflow: hidden;
        border: 3px solid #444;
    }

    .item {
        position: absolute;
        width: 90%;
        left: 50%;
        transform: translateX(-50%);
        bottom: -100%;
        transition: bottom 0.25s ease-out;
        touch-action: none;
    }

    #hud {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        font-size: 22px;
        z-index: 99;
    }

    #end-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.85);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        text-align: center;
        padding: 20px;
        box-sizing: border-box;
    }

    #restart {
        margin-top: 20px;
        padding: 12px 25px;
        background: white;
        color: black;
        border: none;
        font-size: 20px;
        border-radius: 10px;
        cursor: pointer;
    }
</style>
</head>

<body>

<div id="hud">
    ‚≠ê <span id="score">0</span> &nbsp;&nbsp;
    üíÄ <span id="fails">0</span> &nbsp;&nbsp;
    ‚ùå <span id="missed">0</span>
</div>

<div id="game"></div>

<div id="end-screen">
    <div id="end-message"></div>
    <button id="restart" onclick="startGame()">Ricomincia</button>
</div>

<script>
/* ---------------------------------------------------
   CONFIGURAZIONE COMPLETA
--------------------------------------------------- */

// üî• immagini bonus e malus (puoi sostituirle liberamente)
const BONUS_IMAGES = [
    "../res/images/christmas/games/caccia/bell.png", // fiocco
    "../res/images/christmas/games/caccia/crown.png", // pallina
    "../res/images/christmas/games/caccia/letter.png", // regalo
    "../res/images/christmas/games/caccia/ribbon.png", // stella
    "../res/images/christmas/games/caccia/star.png", // stella
];

const MALUS_IMAGES = [
"../res/images/christmas/games/endless/bomb.png", 
    "../res/images/christmas/games/endless/cactus.png", 
    "../res/images/christmas/games/endless/dynamite.png", 
    "../res/images/christmas/games/endless/grinch.png",
];

// üî• difficolt√† configurabile
let HOLES = 6;              // numero di buche
let SPAWN_RATE = 900;       // intervallo tra uno spawn e l‚Äôaltro
let POP_UP_TIME = 800;      // tempo in cui l‚Äôoggetto resta fuori dal buco
let MALUS_PROB = 0.4;       // probabilit√† che esca un malus

// condizioni di vittoria
const SCORE_TO_WIN = 8;
const FAILS_TO_LOSE = 3;
const MISSED_TO_LOSE = 10;


/* ---------------------------------------------------
   VARIABILI
--------------------------------------------------- */

let score = 0;
let fails = 0;
let missed = 0;
let gameRunning = false;
let spawnLoop;
const game = document.getElementById("game");


/* ---------------------------------------------------
   CREAZIONE DELLA GRIGLIA DI BUCHI
--------------------------------------------------- */

function createHoles() {
    game.innerHTML = "";
    for (let i = 0; i < HOLES; i++) {
        const hole = document.createElement("div");
        hole.classList.add("hole");
        game.appendChild(hole);
    }
}


/* ---------------------------------------------------
   AVVIO GIOCO
--------------------------------------------------- */

function startGame() {
    score = 0;
    fails = 0;
    missed = 0;
    gameRunning = true;

    document.getElementById("score").textContent = score;
    document.getElementById("fails").textContent = fails;
    document.getElementById("missed").textContent = missed;

    document.getElementById("end-screen").style.display = "none";

    createHoles();

    clearInterval(spawnLoop);
    spawnLoop = setInterval(spawnItem, SPAWN_RATE);
}


/* ---------------------------------------------------
   GENERAZIONE BONUS/MALUS
--------------------------------------------------- */

function spawnItem() {
    if (!gameRunning) return;

    const holes = document.querySelectorAll(".hole");
    const hole = holes[Math.floor(Math.random() * holes.length)];

    // crea immagine
    const img = document.createElement("img");
    img.classList.add("item");

    const isMalus = Math.random() < MALUS_PROB;

    img.dataset.type = isMalus ? "malus" : "bonus";
    img.src = isMalus
        ? MALUS_IMAGES[Math.floor(Math.random() * MALUS_IMAGES.length)]
        : BONUS_IMAGES[Math.floor(Math.random() * BONUS_IMAGES.length)];

    hole.appendChild(img);

    // animazione "su"
    requestAnimationFrame(() => {
        img.style.bottom = "5%";
    });

    let clicked = false;

    // hit detection
    img.addEventListener("touchstart", () => {
        if (clicked) return;
        clicked = true;

        if (img.dataset.type === "bonus") {
            score++;
            document.getElementById("score").textContent = score;
        } else {
            fails++;
            document.getElementById("fails").textContent = fails;
        }

        img.style.bottom = "-100%";
        setTimeout(() => img.remove(), 200);
        checkEnd();
    });

    // timeout ‚Üí se non cliccato
    setTimeout(() => {
        if (!clicked && gameRunning) {
            if (img.dataset.type === "bonus") {
                missed++;
                document.getElementById("missed").textContent = missed;
            }
            img.style.bottom = "-100%";
            setTimeout(() => img.remove(), 200);
            checkEnd();
        }
    }, POP_UP_TIME);
}


/* ---------------------------------------------------
   FINE PARTITA
--------------------------------------------------- */

function checkEnd() {
    if (score >= SCORE_TO_WIN) {
        endGame("üéâ Hai vinto! Hai colpito abbastanza bonus!");
    }

    if (fails >= FAILS_TO_LOSE) {
        endGame("üíÄ Hai perso! Hai colpito troppi malus!");
    }

    if (missed >= MISSED_TO_LOSE) {
        endGame("üíÄ Hai perso! Hai mancato troppi bonus!");
    }
}

function endGame(message) {
    gameRunning = false;
    clearInterval(spawnLoop);

    document.getElementById("end-message").textContent = message;
    document.getElementById("end-screen").style.display = "flex";
}

startGame();
</script>

</body>
</html>
